<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
	PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper
	namespace="com.github.itsteam4.simplerpg.web.service.HelpdeskDao">

	<resultMap
		type="com.github.itsteam4.simplerpg.web.entity.Helpdesk"
		id="helpdeskMap">
	</resultMap>

	<insert id="insertRow" parameterType="hashMap">
		insert into
		helpdesk(h_seq,h_email,h_name,h_password,h_title,h_content,
		h_ip,h_ref,h_step,h_hit,h_level,h_attach,h_date
		)values(
		(select
		ifnull(max(h_seq)+1,1) from helpdesk
		alias_seq),#{h_email,jdbcType=VARCHAR},#{h_name,jdbcType=VARCHAR},
		#{h_password,jdbcType=VARCHAR},#{h_title,jdbcType=VARCHAR},#{h_content,jdbcType=VARCHAR},
		#{h_ip,jdbcType=VARCHAR},(select ifnull(max(h_seq)+1,1) from helpdesk
		alias_seq),0,
		0,#{h_level,jdbcType=INTEGER},#{h_attach,jdbcType=VARCHAR},#{h_date,jdbcType=VARCHAR}
		)
	</insert>

	<select id="pageList" parameterType="hashMap"
		resultMap="helpdeskMap">
		select * from helpdesk where
		h_title like
		CONCAT('%',#{find},'%') OR
		h_content like CONCAT('%',#{find},'%') OR
		h_name like CONCAT('%',#{find},'%')
		order by h_ref desc limit
		#{startrow},#{endrow}
	</select>



	<select id="selectOne" parameterType="Integer"
		resultMap="helpdeskMap">
		select * from helpdesk where h_seq=#{h_seq}
	</select>
	<!-- <update id="updateRow" parameterType="hashMap"> -->
	<!-- update helpdesk set -->
	<!-- name=#{name,jdbcType=VARCHAR},password=#{password,jdbcType=VARCHAR}, -->
	<!-- phone1=#{phone1,jdbcType=VARCHAR},phone2=#{phone2,jdbcType=VARCHAR}, -->
	<!-- phone3=#{phone3,jdbcType=VARCHAR},postno=#{postno,jdbcType=VARCHAR}, -->
	<!-- addr1=#{addr1,jdbcType=VARCHAR},addr2=#{addr2,jdbcType=VARCHAR}, -->
	<!-- photo=#{photo,jdbcType=VARCHAR} -->
	<!-- where email = #{email} -->
	<!-- </update> -->
	<delete id="deleteRow" parameterType="String">
		delete from helpdesk where
		email=#{email}
	</delete>

	<update id="updateHit" parameterType="Integer">
		update helpdesk set
		h_hit=h_hit+1
		where h_seq=#{h_seq}
	</update>

	<update id="updateRow" parameterType="hashMap">
		update helpdesk set
		h_title=#{h_title,jdbcType=VARCHAR},
		h_content=#{h_content,jdbcType=VARCHAR},
		h_attach=#{h_attach,jdbcType=VARCHAR}
		where h_seq=#{h_seq}
	</update>

	<insert id="insertReplyRow" parameterType="hashMap">
		insert into
		helpdesk(h_seq,h_email,h_name,h_password,h_title,h_content,
		h_ip,h_ref,h_step,h_hit,h_level,h_attach,h_date
		)values(
		(select
		ifnull(max(h_seq)+1,1) from helpdesk
		alias_seq),#{h_email,jdbcType=VARCHAR},#{h_name,jdbcType=VARCHAR},
		#{h_password,jdbcType=VARCHAR},#{h_title,jdbcType=VARCHAR},#{h_content,jdbcType=VARCHAR},
		#{h_ip,jdbcType=VARCHAR},#{h_ref,jdbcType=INTEGER},1,
		0,#{h_level,jdbcType=INTEGER},#{h_attach,jdbcType=VARCHAR},#{h_date,jdbcType=VARCHAR}
		)

	</insert>

	<delete id="deleteRowseq" parameterType="Integer">
		delete from helpdesk
		where
		h_seq=#{h_seq}
	</delete>

	<delete id="deleteRowref" parameterType="Integer">
		delete from helpdesk
		where
		h_ref=#{h_ref}
	</delete>

	<select id="selectRowCount" parameterType="String"
		resultType="Integer">
		select count(*) from helpdesk where
		h_title like
		CONCAT('%',#{find},'%') OR
		h_content like CONCAT('%',#{find},'%') OR
		h_name like CONCAT('%',#{find},'%')
	</select>

</mapper>

