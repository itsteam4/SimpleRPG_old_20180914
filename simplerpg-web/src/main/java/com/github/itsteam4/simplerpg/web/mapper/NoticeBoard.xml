<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
 PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
 "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
 <mapper namespace="com.naver.psgkhs.service.NoticeBoardDao">
  <resultMap type="com.naver.psgkhs.entities.NoticeBoard" id="noticeboardMap">
  </resultMap>
  <insert id="insertRow" parameterType="hashMap">
  	insert into noticeboard(n_seq, n_id, n_type, n_title, n_content, n_ip, n_ref, n_step, n_hit, n_date
  	)values((select ifnull(max(n_seq)+1,1) from noticeboard alias_seq), #{n_id, jdbcType=VARCHAR}, #{n_type, jdbcType=VARCHAR}, #{n_title, jdbcType=VARCHAR}, #{n_content, jdbcType=VARCHAR},
  	#{n_ip, jdbcType=VARCHAR}, (select ifnull(max(n_seq)+1,1) from noticeboard alias_seq), 0, 0,
  	#{n_date, jdbcType=VARCHAR})
  </insert>
  <select id="pageList" parameterType="hashMap" resultMap="noticeboardMap">
  	select * from noticeboard where n_title like CONCAT('%', #{find}, '%') OR n_content like CONCAT('%', #{find}, '%') OR n_type like CONCAT('%', #{find}, '%') order by n_ref desc limit #{startrow}, #{endrow}
  </select>
  <select id="selectRowCount" parameterType="String" resultType="int">
  	select count(*) from noticeboard where n_title like CONCAT('%', #{find}, '%') OR n_content like CONCAT('%', #{find}, '%') OR n_type like CONCAT('%', #{find}, '%')
  </select>
  <select id="selectOne" parameterType="int" resultMap="noticeboardMap">
  	select * from noticeboard where n_seq = #{n_seq}
  </select>
  <update id="updateHit" parameterType="int">
  	update noticeboard set n_hit = n_hit +1 where n_seq = #{n_seq}
  </update>
  <update id="updateRow" parameterType="hashMap">
  	update noticeboard set n_title=#{n_title, jdbcType=VARCHAR}, n_content=#{n_content, jdbcType=VARCHAR} where n_seq = #{n_seq}
  </update>
  <insert id="insertReplyRow" parameterType="hashMap">
  	insert into noticeboard(n_seq, n_id, n_type, n_title, n_content, n_ip, n_ref, n_step, n_hit, n_date
  	)values(
  	(select ifnull(max(n_seq)+1,1) from noticeboard alias_seq), #{n_id, jdbcType=VARCHAR}, 
  	#{n_type, jdbcType=VARCHAR}, #{n_title, jdbcType=VARCHAR}, #{n_content, jdbcType=VARCHAR},
  	#{n_ip, jdbcType=VARCHAR}, #{n_ref, jdbcType=VARCHAR}, 1, #{n_hit, jdbcType=VARCHAR},
  	#{n_date, jdbcType=VARCHAR})
  </insert>
  <delete id="deleteseq" parameterType="int">
  	delete from noticeboard where n_seq = #{n_seq}
  </delete>
  <delete id="deleteref" parameterType="int">
  	delete from noticeboard where n_ref = #{n_ref}
  </delete>
  <select id="selectPageListOracle" resultMap="noticeboardMap">
         select * from (select rownum numrow,A.*
         from (select * from noticeboard where
         n_title like '%'||#{find}||'%' OR
         n_content like '%'||#{find}||'%'
         order by n_ref desc,n_step asc) A) 
         where numrow > #{startrow} and
         numrow <![CDATA[<= ]]>#{endrow}
      </select>
 </mapper>
